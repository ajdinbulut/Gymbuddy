@using GymBuddy.Core.Entities
@using GymBuddy.Infrastructure.Utilities
@using Gymbuddy.Infrastructure
@using Gymbuddy.Utilities
@using Gymbuddy.ViewModels
@model PostViewModel
@inject UserManager _userManager
@inject GymDB _db
        <style>
           
    #form1{
        border:solid 3px grey;
        border-radius:1em;
        background-color:grey;
            }
    #post1{
        width:50%;
        height:50%;
        border:solid 3px grey;
        margin-bottom:3px;
        border-radius:0.5em;
        background-color:grey;
    }
   
    #post2{
        background-color:#AFAFAF;
    }
    /*img{
        width:50%;
        height:50%;
        margin-left:5px;
    }*/
    p{
        margin-left:5px;
    }
   /* #dd1{
        
        position:relative;
        left:80%;
        
    }*/
    #container{
        height:100%;
        width:75%;
        margin:auto;
        padding:0.5em;
    }
    *{
        box-sizing:border-box;
        margin:0;
        padding:0;
    }
    #postbtn{
        color:black;
        text-decoration:none;
        border:none;
        background-color:rgb(255,255,255);
        padding:0.2em 0.5em;
        margin-top:3px;
    }
    #postbtn:hover{
        background-color:rgb(255,255,255,0.8);
    }
  
    #postimg{
        height:100%;
        width:100%;
    }
    #comments{
        display:flex;
        flex-direction:column;
        justify-content:center;
        margin:5px;
        border-radius:0.5em;
    }
    #likebtn{
        background-color:white;
        margin-left:5px;
        padding:2px 3px;
        transition:all 0.3s ease 0s;
        border:1px solid black;
    }
    #likebtn:hover{
        color:#0088a9;
        background-color: rgb(255,255,255,0.9);

    }
    #ddbtn{
        margin-left:auto;
    }
  
        </style>
@if(TempData["success"] != null){
       <h2>@TempData["success"]</h2>
}

 <div class="bg-dark d-block mt-0 mb-0 d-flex flex-column align-items-center" id="container">

@if (_userManager.isSignedIn())
{

    <form asp-action="Post" asp-controller="Home" method="post" enctype="multipart/form-data">
        <div class=" p-3 mt-4" style="height:200px;width:700px" id="form1">
            <input type="hidden" name="id" />
            <div class="col-md-12 ">
                <textarea asp-for="Post.Description" placeholder="Enter a description of your post.." class="form-control"></textarea> 
            </div>
            <div class="col-md-6 mt-2">
                <label hidden asp-for="Post.ImageUrl"></label>
                <input type="file" name="file" placeholder="Select an image.." class="form-control"/>
            </div>
           <button type="submit"  id="postbtn">Submit</button>

        </div>
    </form>

    @foreach (var post in Model.Posts)
    { 
        <a hidden asp-for="@post.Id" id="postId"></a>
        <div id="post1" class="mt-3 mb-3 ms-lg-2 w-50 h-50 shadow-lg" style="height:600px;width:500px">
            <div id="post2">
                <div style="display:flex;flex-direction:row;align-items:center;">
                     <img src="@post.User.ProfilePhoto" style="width:30px;height:30px;border-radius:50%;margin-left:5px">
                     <h3 class="ms-lg-2 d-inline">@post.User.Name</h3>
                
                   
                    <div class="btn-group dropstart" id="ddbtn">
                        <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                         </button>
                            <ul class="dropdown-menu" aria-labelledby="#dropdownMenuButton">
                    @if (Model.User.Id == post.UserId)
                    {
                                <li > 
                                    <a class="dropdown-item" asp-action="DeletePost" asp-controller="Home" asp-route-id="@post.Id" >Delete </a>
                                </li>
                            }
                            </ul>
                    </div>
                </div>
                
                <hr class="text-black">
                <p class="ms-lg-2">@post.Description</p>
                
            </div>
            <div >
              <img src="@post.ImageUrl" class="rounded mx-auto d-block" id="postimg">
            </div>
            <hr class="text-black">
            <div>
                @if(!_db.PostLikes.Any(x=> x.PostId == post.Id && x.UserId == Model.User.Id)){
                 <button id="likebtn" data-postId="@post.Id" >@*<i class="fa-regular fa-thumbs-up"></i>*@ Like</button>
                }else{
                 <button id="dislike"  style="color:blue;border:1px solid blue;padding:2px 3px" data-postid="@post.Id" >@*<i class="fa-regular fa-thumbs-up"></i> *@Liked</button>
                }
            </div>
            <hr class="text-black">

            
            @foreach(var item in post.Comments){
                @if(@item.Id != null){
             <div class="bg-white" id="comments" style="">
                 <div class="bg-white" style="display:flex;flex-direction:row; align-items:center;">
                     <div>
                         <img src="@item.User.ProfilePhoto" style="width:30px;height:30px;border-radius:50%;margin-left:10px;margin-top:10px;display:inline">
                    </div>
                 <div>
                   <h6 style="margin:5px;color:blue;" id="h6">@item.User.Name</h6>
                 </div>
                 </div>
                 <span style="margin:5px" id="span">@item.Description</span>
             </div>
            
           }
            }
                
                <form asp-action="Comment" asp-controller="Home" asp-route-id="@post.Id" method="post">
            <div>
                        
                <textarea asp-for="Comment.Description" placeholder="Comment something.." class="form-control d-inline"></textarea>
                <button type="submit"class="btn btn-dark d-inline">Submit</button>
            </div>
            </form>
        </div>
    }

}
</div>
@section Scripts{
    <script>
        
    let likebtn = document.getElementById("likebtn");
    likebtn.addEventListener('click', function(e) {
        let postId = e.target.getAttribute('data-postId');
    $.ajax({
        type: 'POST',
        url: '@Url.Action("LikePost")',
        dataType: "json",
        data: {PostId: postId },
        success: function(result) {
            likebtn.innerHTML = "Liked";
            likebtn.style.color = "blue";
            likebtn.style.border = "1px solid blue";
            likebtn.style.padding = "2px 3px";
        },
        error: function(req, status, error) {
            console.log("there is error");
        }
    })
    })
    
        let dislikebtn = document.getElementById('dislike');
        dislikebtn.addEventListener('click',function(e){
            let postId = e.target.getAttribute('data-postid');
            $.ajax({
                type: 'POST',
                url: '@Url.Action("DislikePost")',
                dataType: "json",
                data: { PostId: postId },
                success: function (result) {
                    dislikebtn.innerHTML = "Like";
                    dislikebtn.style.color = "black";
                    dislikebtn.style.border = "1px solid black";
                    dislikebtn.style.padding = "2px 3px";
                },
                error: function (req, status, error) {
                    console.log("there is error");
                }
            })
        })
            
      

        
        



    </script>
}